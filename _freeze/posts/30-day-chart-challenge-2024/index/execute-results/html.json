{
  "hash": "8a1ee86825d581bf75352f865a49f89e",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"30 Day Chart Challenge 2024\"\ndescription: \"Let's make some charts!\"\nauthor: \"gregers kjerulf dubrow\"\ndate: \"today\"\ncategories: [post, rstats, ggplot, dataviz, chartchallenge, tidytuesday]\nimage: \"prompts.png\"\ntoc: true\nlightbox: true\neditor: \n  mode: source\n---\n\n\n\n\n![](prompts.png){width=\"75%\" fig-align=\"left\" fig-alt=\"image listing the prompts for the 30 day chart challenge 2024.\"}\n\n## My Plan for the Challenge {#plan}\n\nIf you regularly scroll through dataviz social media you probably see lots of posts in April where people show off their work for the [30 Day Chart Challenge](https://github.com/30DayChartChallenge/Edition2024). I never participate in these chart or map challenges because usually they take me by surprise and it's alreayd a week in before I notice and then I figure I'm too late.\n\nWell not this year. Even though I'm (checks calendar) *three weeks* late to the party, I'm going to try and add a few charts to the challenge. I figure it's a good way to keep me consistently creating new visualisations, using the prompts to spur me to think about different data sources and dataviz approaches. My plan is to:\n\n-   Produce charts for as many prompts as possible, working in prompt-day order.\n-   Post them to social media on my [Bluesky](https://bsky.app/profile/gregerskjerulf.bsky.social), [Mastodon](https://fosstodon.org/@Greg_Dubrow), [Twitter](https://twitter.com/greg_dubrow), and [LinkedIn](https://www.linkedin.com/in/dubrowg/) accounts.\n-   Add them to this post, meaning the posting date will refresh to the date I've added the chart.So If I get to alot or even all of them, this will be a long post.\n\nI may not get to every prompt, but I'll do what I can. So let's get going.\n\n## Prompt #1 - Part-to-Whole {#prompt1}\n\nI chose to interpret this prompt by doing a stacked bar chart displaying educational attainment as a proportion of populations by regions in the UK. It doubles as a late-to-the-party entry for the [January 23, 2024 Tidy Tuesday](https://github.com/rfordatascience/tidytuesday/tree/master/data/2024/2024-01-23) challenge.\n\nThe original data is from the UK Office of National Statistics, in a report they produced looking at [educational attainment by socio-economic factors](https://www.ons.gov.uk/peoplepopulationandcommunity/educationandchildcare/articles/whydochildrenandyoungpeopleinsmallertownsdobetteracademicallythanthoseinlargertowns/2023-07-25).\n\nMy plan for this was to knock out the chart in a couple of hours, but I needed up having to do a bit more data transformation than I thought. I also had to read up a bit on UK education [levels](https://www.gov.uk/what-different-qualification-levels-mean/list-of-qualification-levels) and [stages](https://www.gov.uk/national-curriculum).\n\nFirst we'll get and clean the data...\n\n\n::: {.cell ECHO='true'}\n\n```{.r .cell-code .code-overflow-scroll  code-fold=\"true\" code-summary=\"Show code for getting and cleaning data\"}\nlibrary(tidyverse) # to do tidyverse things\nlibrary(tidytuesdayR) #to get data from tidy tuesday repo\nlibrary(tidylog) # to get a log of what's happening to the data\nlibrary(janitor) # tools for data cleaning\nlibrary(ggtext) # to help make ggplot text look good\n\n# load tidy tuesday data\nukeduc1 <- tt_load(\"2024-01-23\")\n#> \n#> \tDownloading file 1 of 1: `english_education.csv`\n\n# create tibble from csv, clean data, add some fields for the chart\nukeduc <- as_tibble(ukeduc1$english_education) %>%\n\tmutate(town11nm = ifelse(town11nm == \"Outer london BUAs\", \"Outer London BUAs\", town11nm)) %>%\n\tmutate(ttwa_classification = ifelse(\n\t\ttown11nm %in% c(\"Inner London BUAs\", \"Outer London BUAs\"), \n\t\t\"Majority conurbation\", ttwa_classification)) %>%\n\tmutate(ttwa11nm = ifelse(\n\t\ttown11nm %in% c(\"Inner London BUAs\", \"Outer London BUAs\"), \"London\", ttwa11nm)) %>%\n\tmutate(ttwa11cd = ifelse(\n\t\ttown11nm %in% c(\"Inner London BUAs\", \"Outer London BUAs\"), \"E30000234\", ttwa11cd)) %>%\n\tmutate(across(26:29, ~ifelse(is.na(.),0,.))) %>%\n\tmutate(level_sum = rowSums(.[c(26:29)])) %>%\n\t# to get the number of students in the achievement groups we need to multiply the cohort\n\t# by the percentage and divide by 100 as in the original data they were displayed as \n\t# full numbers, eg 17.2 instead of 0.172.\n\tmutate(highest_level_qualification_achieved_by_age_22_na = 100 - level_sum) %>%\n\tmutate(n_lesslev1_age22 =\n\t\t\tround(highest_level_qualification_achieved_by_age_22_less_than_level_1 * (ks4_2012_2013_counts/100) ,0)) %>%\n\tmutate(n_lev1to2_age22 =\n\t\t\tround(highest_level_qualification_achieved_by_age_22_level_1_to_level_2 * (ks4_2012_2013_counts/100) ,0)) %>%\n\tmutate(n_lev3to5_age22 =\n\t\t\tround(highest_level_qualification_achieved_by_age_22_level_3_to_level_5 * (ks4_2012_2013_counts/100) ,0)) %>%\n\tmutate(n_lev6plus_age22 =\n\t\t\tround(highest_level_qualification_achieved_by_age_22_level_6_or_above * (ks4_2012_2013_counts/100) ,0)) %>%\n\tmutate(n_lev_na_age22 =\n\t\t\tround(highest_level_qualification_achieved_by_age_22_na * (ks4_2012_2013_counts/100) ,0))\n```\n:::\n\n\nOk, so we have data, let's make the chart. It's a horizontal bar chart showing the eudcational attainment at age 22 of a cohort of 15-16 year old students who sat for college qualifying exams (GCSEs) in the 2012-13 school year. Meaning the ending time point here is 2018-19. Attainment is plotted by level and by region. Because the original data is by town, we have to group by region to get what we want.\n\n\n::: {.cell ECHO='true'}\n\n```{.r .cell-code .code-overflow-scroll  code-fold=\"true\" code-summary=\"Show code for making the chart\"}\n# need to create cohort population by region\nukeduc %>%\n\trename(region =rgn11nm ) %>%\n\t# group by regions and create region totals \n\tgroup_by(region) %>%\n\tsummarise(region_cohort = sum(ks4_2012_2013_counts),\n\t\t\t\t\tregion_levless1_age22 = sum(n_lesslev1_age22),\n\t\t\t\t\tregion_lev1to2_age22 = sum(n_lev1to2_age22),\n\t\t\t\t\tregion_lev3to5_age22 = sum(n_lev3to5_age22),\n\t\t\t\t\tregion_lev6plus_age22 = sum(n_lev6plus_age22),\n\t\t\t\t\tregion_lev_na_age22 = sum(n_lev_na_age22)) %>%\n\t# pivot longer and make the education attainment field into factors. \n\t# factor labels for the chart\n\tpivot_longer(cols = ends_with(\"age22\"), \n\t\t\t\t\t\tnames_to = \"ed_ettain_age22\", \n\t\t\t\t\t\tvalues_to = \"ed_attain_n\") %>%\n\tmutate(\n\t\ted_ettain_age22 = \n\t\t\tfactor(ed_ettain_age22, \n\t\t\t\t\tlevels = c(\"region_lev_na_age22\", \"region_levless1_age22\", \"region_lev1to2_age22\", \n\t\t\t\t\t\t\t\"region_lev3to5_age22\",  \"region_lev6plus_age22\"), \n\t\t\t\t\tlabels = c(\"No data\", \"Level <1\", \"Level = 1-2\", \"Level = 3-5\", \"Level = 6+\"))) %>%\n\tmutate(ed_attain_pct = ed_attain_n / region_cohort) %>%\n\tmutate(ed_attain_pct2 = round(ed_attain_pct*100, 1)) %>%\n\tungroup() %>%\n\tmutate(region = factor(region)) %>%\n\tfilter(!is.na(region)) %>%\n\t# pass this temporary set thru to the ggplot call\n\t{. ->> tmp} %>%\n\tggplot(aes(ed_attain_pct, fct_rev(region), fill = fct_rev(ed_ettain_age22))) +\n\tgeom_bar(stat = \"identity\") +\n\tscale_x_continuous(\n\t\texpand = c(0,0), \n\t\tbreaks = c(0, 0.25, 0.50, 0.75, 1), \n\t\tlabels = c(\"0\", \"25%\", \"50%\", \"75%\", \"100%\")) +\n\tgeom_text(data = subset(tmp, ed_attain_pct >0.025),\n\t\taes(label = scales::percent(round(ed_attain_pct , 2))),\n\t\t\t\t\tposition = position_stack(vjust = 0.5),\n\t\t\t\t\tcolor= \"white\", vjust = 0.5, size = 5) +\n\tlabs(title = \"Students in London most likely to have at least 4-year degree by Age 22\",\n\t\tsubtitle = \"Sixth Year Educational Outcomes for Level 4 2012-13 Cohort by UK Region\",\n\t\tcaption = \"*Tidy Tuesday data 01/23/2024, from UK Office of National Statistics*\",\n\t\tx = \"\", y = \"Region\") +\n\tscale_fill_brewer(palette = \"Set2\") +\n\ttheme_minimal() +\n\ttheme(legend.position = \"bottom\", legend.spacing.x = unit(0, 'cm'), \n\t\t\tlegend.key.width = unit(1.5, 'cm'), legend.margin=margin(-10, 0, 0, 0),\n\t\t\tplot.title = element_text(hjust = 1), \n\t\t\tplot.caption = element_markdown(),\n\t\t\tpanel.grid.major = element_blank(), panel.grid.minor = element_blank()) +\n\tguides(fill = guide_legend(\n\t\tlabel.position = \"bottom\", reverse = TRUE, \n\t\ttitle = \"Cohort at Age 22\", title.position = \"top\"))\n```\n\n::: {.cell-output-display}\n![](images/prompt1_2-1.png){width=100%}\n:::\n:::\n\n\nWe see from this chart that most in regions the rate of 4-year college degree completion (level 6+) was in the mid-high 20s, with students from the London region having the highest rate at 36%.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}