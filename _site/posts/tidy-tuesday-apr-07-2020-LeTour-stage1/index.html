<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="gregers kjerulf dubrow">
<meta name="dcterms.date" content="2020-11-30">

<title>gregers kjerulf dubrow - Tidy Tuesday, April 07, 2020 - Le Tour! (Stage 1, cleaning the data)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script type="text/plain" cookie-consent="tracking">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-157557326-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"express",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  });
});
</script> 
  


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="gregers kjerulf dubrow - Tidy Tuesday, April 07, 2020 - Le Tour! (Stage 1, cleaning the data)">
<meta property="og:description" content="|">
<meta property="og:image" content="https://www.gregdubrow.io/posts/tidy-tuesday-apr-07-2020-LeTour-stage1/Kraftwerk_Tour_De_France_Soundtracks_album_cover.png">
<meta property="og:site-name" content="gregers kjerulf dubrow">
<meta property="og:image:height" content="300">
<meta property="og:image:width" content="300">
<meta name="twitter:title" content="gregers kjerulf dubrow - Tidy Tuesday, April 07, 2020 - Le Tour! (Stage 1, cleaning the data)">
<meta name="twitter:description" content="|">
<meta name="twitter:image" content="https://www.gregdubrow.io/posts/tidy-tuesday-apr-07-2020-LeTour-stage1/Kraftwerk_Tour_De_France_Soundtracks_album_cover.png">
<meta name="twitter:creator" content="@greg_dubrow">
<meta name="twitter:image-height" content="300">
<meta name="twitter:image-width" content="300">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">gregers kjerulf dubrow</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About me</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/greg-dubrow"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/dubrowg/"><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/greg_dubrow"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Tidy Tuesday, April 07, 2020 - Le Tour! (Stage 1, cleaning the data)</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">post</div>
                <div class="quarto-category">tidytuesday</div>
                <div class="quarto-category">rstats</div>
                <div class="quarto-category">ggplot</div>
                <div class="quarto-category">dataviz</div>
                <div class="quarto-category">data visualization</div>
                <div class="quarto-category">sports</div>
                <div class="quarto-category">cycling</div>
                <div class="quarto-category">tour de france</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>gregers kjerulf dubrow </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 30, 2020</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p><img src="Kraftwerk_Tour_De_France_Soundtracks_album_cover.png" class="img-fluid"> | <img src="bike_twinpeaks.jpg" class="img-fluid" style="width:49.0%"></p>
<section id="a-mountain-of-data-about-the-tour-de-france" class="level3">
<h3 class="anchored" data-anchor-id="a-mountain-of-data-about-the-tour-de-france">A mountain of data about the Tour de France…</h3>
<p>Having looked at <a href="https://www.gregdubrow.io/posts/tidy-tuesday-nov-11-2020-hiking-trails-in-wash-state/">hiking trails in Washington state</a> and <a href="https://www.gregdubrow.io/posts/tidy-tuesday-maryland-bridges/">bridges in Maryland</a> I poked around the <a href="https://github.com/rfordatascience/tidytuesday">#TidyTuesday repo</a> and saw this <a href="https://github.com/rfordatascience/tidytuesday/tree/master/data/2020/2020-04-07">trove of data</a> from back in April on <a href="https://www.letour.fr/en/">The Tour de France</a>. I love this race, I cycle for exercise, and I love the Kraftwerk album, so of course I had to dig in.</p>
<p>So I don’t bury the lede, this is a two-part post. Why? Because there was a lot of data munging &amp; cleaning needed to get the data into shape for whart I wanted to do. So this post is all about what I needed to do on that end. The analysis post will come soon. Also, I’m trying to work out how to do a code show/hide thing in hugo academic so bear with me that the code takes up lots of pixels.</p>
<p>(*update - migrating to ‘Quarto’ means a native code-fold feature…hooray!)</p>
<p>So let’s dig in…first we’ll load packages and create a ’%notin% operator…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytuesdayR) <span class="co"># to load tidytuesday data</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># to do tidyverse things</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidylog) <span class="co"># to get a log of what's happening to the data</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tdf) <span class="co"># to get original stage results file</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># create notin operator to help with cleaning &amp; analysis</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">%notin%</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">negate</span>(<span class="st">`</span><span class="at">%in%</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There’s a ton of data here, sourced from the <a href="https://github.com/alastairrushworth/tdf"><code>tdf</code> package from Alastair Rushworth</a> and (Thomas Camminady’s data set) (https://github.com/camminady/LeTourDataSet), via <a href="https://www.kaggle.com/jaminliu/a-brief-tour-of-tour-de-france-in-numbers/">Kaggle</a></p>
<p>There are three distinct sets to work thru, each going back to the first run of the race in 1903:<br>
* A dataframe of overall (<a href="https://en.wikipedia.org/wiki/General_classification_in_the_Tour_de_France">General Classification, or Yellow Jersey / <em>maillot jaune</em></a>) winners from 1903 to 2019 comes from the Tidy Tuesday frame.<br>
* A dataframe with stage winners for races 1903 to 2017, also in the Tidy Tuesday set, sourced from Kaggle.<br>
* A frame of overall stage results, sourced from the <code>tdf</code> pacakge due to issues with date conversion in the data included in the Tidy Tuesday set.</p>
<p>The stage winner set needs a bit of mungung…I created a stage_results_id column similar to the one in the stage results set. But it needs leading zeros for stages 1-9 so it sorts properly.</p>
<p>I then got it in my head I wanted results through 2020, so I grabbed them from wikipedia; but the hard way, with copy-paste since my scraping skills aren’t there &amp; I just wanted it done. Data is uploaded to my <a href="https://github.com/greg-dubrow/tidy-tuesday-projects/tree/master/2020/tt_2020-04-07_letour/data">github repo</a> if you want to use it. (yes, it’s in an excel file…)</p>
<div class="cell">
<details>
<summary>Show tdf data cleaning pt1</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load main file from tt repo</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>tt_tdf <span class="ot">&lt;-</span> tidytuesdayR<span class="sc">::</span><span class="fu">tt_load</span>(<span class="st">'2020-04-07'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Downloading file 1 of 3: `stage_data.csv`
    Downloading file 2 of 3: `tdf_stages.csv`
    Downloading file 3 of 3: `tdf_winners.csv`</code></pre>
</div>
<details>
<summary>Show tdf data cleaning pt1</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create race winners set. comes from tdf package. includes up to 2019</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>tdf_winners <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(tt_tdf<span class="sc">$</span>tdf_winners)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create stage winner set. in tt file, comes from kaggle, includes up to 2017</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>tdf_stagewin1 <span class="ot">&lt;-</span> tt_tdf<span class="sc">$</span>tdf_stages <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.character, str_trim)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># pulled 2018 - 2020 from wikipedia</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># read in excel - need to separate route field to Origin &amp; Destination</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>tdf_stagewin2 <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"data/tdf_stagewinners_2018-20.xlsx"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Stage =</span> <span class="fu">as.character</span>(Stage)) <span class="sc">%&gt;%</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> lubridate<span class="sc">::</span><span class="fu">as_date</span>(Date)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Course, <span class="fu">c</span>(<span class="st">"Origin"</span>, <span class="st">"Destination"</span>), <span class="st">"to"</span>, <span class="at">extra =</span> <span class="st">"merge"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.character, str_trim) <span class="sc">%&gt;%</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Stage, Date, Distance, Origin, Destination, Type, Winner, <span class="at">Winner_Country =</span> Winner_country)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co"># join with rbind (since I made sure to put 2018-2020 data in same shape as tt set)</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co"># clean up a bit</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>tdf_stagewin <span class="ot">&lt;-</span> <span class="fu">rbind</span>(tdf_stagewin1, tdf_stagewin2) <span class="sc">%&gt;%</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">race_year =</span> lubridate<span class="sc">::</span><span class="fu">year</span>(Date)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Stage =</span> <span class="fu">ifelse</span>(Stage <span class="sc">==</span> <span class="st">"P"</span>, <span class="st">"0"</span>, Stage)) <span class="sc">%&gt;%</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage_ltr =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(Stage, <span class="st">"a"</span>) <span class="sc">~</span> <span class="st">"a"</span>,</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">str_detect</span>(Stage, <span class="st">"b"</span>) <span class="sc">~</span> <span class="st">"b"</span>,</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">str_detect</span>(Stage, <span class="st">"c"</span>) <span class="sc">~</span> <span class="st">"c"</span>,</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>                               <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage_num =</span> <span class="fu">str_remove_all</span>(Stage, <span class="st">"[abc]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage_num =</span> stringr<span class="sc">::</span><span class="fu">str_pad</span>(stage_num, <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage_results_id =</span> <span class="fu">paste0</span>(<span class="st">"stage-"</span>, stage_num, stage_ltr)) <span class="sc">%&gt;%</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">split_stage =</span> <span class="fu">ifelse</span>(stage_ltr <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>), <span class="st">"yes"</span>, <span class="st">"no"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extract first and last names from winner field</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">winner_first =</span> <span class="fu">str_match</span>(Winner, <span class="st">"(^.+)</span><span class="sc">\\</span><span class="st">s"</span>)[, <span class="dv">2</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">winner_last=</span> <span class="fu">gsub</span>(<span class="st">".* "</span>, <span class="st">""</span>, Winner)) <span class="sc">%&gt;%</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># clean up stage types, collapse into fewer groups</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage_type =</span> <span class="fu">case_when</span>(Type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Flat cobblestone stage"</span>, <span class="st">"Flat stage"</span>, <span class="st">"Flat"</span>,</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"Flat Stage"</span>, <span class="st">"Hilly stage"</span>, <span class="st">"Plain stage"</span>, </span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"Plain stage with cobblestones"</span>) </span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>                                <span class="sc">~</span> <span class="st">"Flat / Plain / Hilly"</span>,</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>                                Type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"High mountain stage"</span>, <span class="st">"Medium mountain stage"</span>,</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"Mountain stage"</span>, <span class="st">"Mountain Stage"</span>, <span class="st">"Stage with mountain"</span>,</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"Stage with mountain(s)"</span>, <span class="st">"Transition stage"</span>)</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>                                <span class="sc">~</span> <span class="st">"Mountain"</span>,</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>                                Type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Individual time trial"</span>, <span class="st">"Mountain time trial"</span>) </span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>                                <span class="sc">~</span> <span class="st">"Time Trail - Indiv"</span>,</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>                                Type <span class="sc">==</span> <span class="st">"Team time trial"</span> <span class="sc">~</span> <span class="st">"Time Trail - Team"</span>,</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>                                <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.character, str_trim) <span class="sc">%&gt;%</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(race_year), stage_results_id) <span class="sc">%&gt;%</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(race_year, stage_results_id, <span class="at">stage_date =</span> Date, stage_type, Type, split_stage,</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>         Origin, Destination, Distance, Winner, winner_first, winner_last,</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>         Winner_Country, <span class="fu">everything</span>())</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a><span class="co"># take a look at this awesome dataset</span></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(tdf_stagewin)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,299
Columns: 16
$ race_year        &lt;dbl&gt; 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020,…
$ stage_results_id &lt;chr&gt; "stage-01", "stage-02", "stage-03", "stage-04", "stag…
$ stage_date       &lt;date&gt; 2020-08-29, 2020-08-30, 2020-08-31, 2020-09-01, 2020…
$ stage_type       &lt;chr&gt; "Flat / Plain / Hilly", "Mountain", "Flat / Plain / H…
$ Type             &lt;chr&gt; "Flat stage", "Medium mountain stage", "Flat stage", …
$ split_stage      &lt;chr&gt; "no", "no", "no", "no", "no", "no", "no", "no", "no",…
$ Origin           &lt;chr&gt; "Nice", "Nice", "Nice", "Sisteron", "Gap", "Le Teil",…
$ Destination      &lt;chr&gt; "Nice", "Nice", "Sisteron", "Orcières-Merlette", "Pri…
$ Distance         &lt;dbl&gt; 156.0, 186.0, 198.0, 160.5, 183.0, 191.0, 168.0, 141.…
$ Winner           &lt;chr&gt; "Alexander Kristoff", "Julian Alaphilippe", "Caleb Ew…
$ winner_first     &lt;chr&gt; "Alexander", "Julian", "Caleb", "Primož", "Wout van",…
$ winner_last      &lt;chr&gt; "Kristoff", "Alaphilippe", "Ewan", "Roglič", "Aert", …
$ Winner_Country   &lt;chr&gt; "NOR", "FRA", "AUS", "SLO", "BEL", "KAZ", "BEL", "FRA…
$ Stage            &lt;chr&gt; "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "1…
$ stage_ltr        &lt;chr&gt; "", "", "", "", "", "", "", "", "", "", "", "", "", "…
$ stage_num        &lt;chr&gt; "01", "02", "03", "04", "05", "06", "07", "08", "09",…</code></pre>
</div>
</div>
<p>Stage data in CSV from the tidy tuesday repository seems to have truncated the times, leaving only the seconds in a character field. To get complete results we need to pull from <code>tdf</code> package using the cleaning script from the Tidy Tuesday page. Some operations will take a while, so best to run as a background job if you want to do something else while it runs. Or go get a cup of coffee.</p>
<p>In terms of cleaning:<br>
* The stage_results_id &amp; rank fields needs leading zeros.<br>
* The rank field needs a bit of clean-up to fix the 1000s codes.<br>
* Since rider names were last-first, I wanted to separate out first and last, and also make a field with the full name, but first name in front. Stackoverlflow was my regex friend here.<br>
* Other minor fixes</p>
<p>In the process of cleaning and comparing to the stage winners set, I noticed there were some problems in years where individual stages were split into 2 or 3 legs (A, B &amp; C). Either while it was scraped or combined, the A leg results ended up repeating to the B leg, and in some cases the C leg wasn’t reported. I put it in as an issue in the github repo. But that shouldn’t take away from what’s an amazing dataset to work with. In the analysis section I’ll work around the problems with those stages.</p>
<div class="cell">
<details>
<summary>Show tdf data cleaning pt2</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>all_years <span class="ot">&lt;-</span> tdf<span class="sc">::</span>editions <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(stage_results) <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage_results =</span> <span class="fu">map</span>(stage_results, <span class="sc">~</span> <span class="fu">mutate</span>(.x, <span class="at">rank =</span> <span class="fu">as.character</span>(rank)))) <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(stage_results)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>stage_all <span class="ot">&lt;-</span> all_years <span class="sc">%&gt;%</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(stage_results) <span class="sc">%&gt;%</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">flatten_df</span>()</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>combo_df <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(all_years, stage_all) <span class="sc">%&gt;%</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>stage_results)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>tdf_stagedata <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(combo_df <span class="sc">%&gt;%</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(edition, start_date,stage_results_id<span class="sc">:</span><span class="fu">last_col</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">race_year =</span> lubridate<span class="sc">::</span><span class="fu">year</span>(start_date)) <span class="sc">%&gt;%</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">age =</span> age...<span class="dv">25</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># to add leading 0 to stage, extract num, create letter, add 0s to num, paste</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage_num =</span> <span class="fu">str_replace</span>(stage_results_id, <span class="st">"stage-"</span>, <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage_ltr =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(stage_num, <span class="st">"a"</span>) <span class="sc">~</span> <span class="st">"a"</span>,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">str_detect</span>(stage_num, <span class="st">"b"</span>) <span class="sc">~</span> <span class="st">"b"</span>,</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>                               <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage_num =</span> <span class="fu">str_remove_all</span>(stage_num, <span class="st">"[ab]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage_num =</span> stringr<span class="sc">::</span><span class="fu">str_pad</span>(stage_num, <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage_results_id2 =</span> <span class="fu">paste0</span>(<span class="st">"stage-"</span>, stage_num, stage_ltr)) <span class="sc">%&gt;%</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">split_stage =</span> <span class="fu">ifelse</span>(stage_ltr <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>), <span class="st">"yes"</span>, <span class="st">"no"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fix 1000s rank. change to DNF</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">ifelse</span>(rank <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"1003"</span>, <span class="st">"1005"</span>, <span class="st">"1006"</span>), <span class="st">"DNF"</span>, rank)) <span class="sc">%&gt;%</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank2 =</span> <span class="fu">ifelse</span>(rank <span class="sc">%notin%</span> <span class="fu">c</span>(<span class="st">"DF"</span>, <span class="st">"DNF"</span>, <span class="st">"DNS"</span>, <span class="st">"DSQ"</span>,<span class="st">"NQ"</span>,<span class="st">"OTL"</span>),</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>                        stringr<span class="sc">::</span><span class="fu">str_pad</span>(rank, <span class="dv">3</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="dv">0</span>), rank)) <span class="sc">%&gt;%</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extract first and last names from rider field</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rider_last =</span> <span class="fu">str_match</span>(rider, <span class="st">"(^.+)</span><span class="sc">\\</span><span class="st">s"</span>)[, <span class="dv">2</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rider_first=</span> <span class="fu">gsub</span>(<span class="st">".* "</span>, <span class="st">""</span>, rider)) <span class="sc">%&gt;%</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rider_firstlast =</span> <span class="fu">paste0</span>(rider_first, <span class="st">" "</span>, rider_last)) <span class="sc">%&gt;%</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>stage_results_id, <span class="sc">-</span>start_date, ) <span class="sc">%&gt;%</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fix 1967 &amp; 1968</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage_results_id2 =</span> <span class="fu">ifelse</span>((race_year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1967</span>, <span class="dv">1968</span>) <span class="sc">&amp;</span> stage_results_id2 <span class="sc">==</span> <span class="st">"stage-00"</span>),</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>         <span class="st">"stage-01a"</span>, stage_results_id2)) <span class="sc">%&gt;%</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage_results_id2 =</span> <span class="fu">ifelse</span>((race_year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1967</span>, <span class="dv">1968</span>) <span class="sc">&amp;</span> stage_results_id2 <span class="sc">==</span> <span class="st">"stage-01"</span>),</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>         <span class="st">"stage-01b"</span>, stage_results_id2)) <span class="sc">%&gt;%</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">split_stage =</span> <span class="fu">ifelse</span>((race_year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1967</span>, <span class="dv">1968</span>) <span class="sc">&amp;</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>                                 stage_results_id2 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"stage-01a"</span>, <span class="st">"stage-01b"</span>)),</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"yes"</span>, split_stage)) <span class="sc">%&gt;%</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(edition, race_year, <span class="at">stage_results_id =</span> stage_results_id2, split_stage,</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>         rider, rider_first, rider_last, rider_firstlast, rank2,</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>         time, elapsed, points, bib_number, team, age, <span class="fu">everything</span>())</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(tdf_stagedata, <span class="st">"data/tdf_stagedata.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>tdf_stagedata <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/tdf_stagedata.rds"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(tdf_stagedata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 255,752
Columns: 18
$ edition          &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ race_year        &lt;dbl&gt; 1903, 1903, 1903, 1903, 1903, 1903, 1903, 1903, 1903,…
$ stage_results_id &lt;chr&gt; "stage-01", "stage-01", "stage-01", "stage-01", "stag…
$ split_stage      &lt;chr&gt; "no", "no", "no", "no", "no", "no", "no", "no", "no",…
$ rider            &lt;chr&gt; "Garin Maurice", "Pagie Émile", "Georget Léon", "Auge…
$ rider_first      &lt;chr&gt; "Maurice", "Émile", "Léon", "Fernand", "Jean", "Marce…
$ rider_last       &lt;chr&gt; "Garin", "Pagie", "Georget", "Augereau", "Fischer", "…
$ rider_firstlast  &lt;chr&gt; "Maurice Garin", "Émile Pagie", "Léon Georget", "Fern…
$ rank2            &lt;chr&gt; "001", "002", "003", "004", "005", "006", "007", "008…
$ time             &lt;Period&gt; 17H 45M 13S, 55S, 34M 59S, 1H 2M 48S, 1H 4M 53S, 1…
$ elapsed          &lt;Period&gt; 17H 45M 13S, 17H 46M 8S, 18H 20M 12S, 18H 48M 1S, …
$ points           &lt;int&gt; 100, 70, 50, 40, 32, 26, 22, 18, 14, 10, 8, 6, 4, 2, …
$ bib_number       &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ team             &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ age              &lt;int&gt; 32, 32, 23, 20, 36, 37, 25, 33, NA, 22, 26, 28, 21, 2…
$ rank             &lt;chr&gt; "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "1…
$ stage_num        &lt;chr&gt; "01", "01", "01", "01", "01", "01", "01", "01", "01",…
$ stage_ltr        &lt;chr&gt; "", "", "", "", "", "", "", "", "", "", "", "", "", "…</code></pre>
</div>
</div>
<p>Poking around the Kaggle site referenced above I found <a href="https://github.com/thomascamminady/LeTourDataSet/tree/master">these datasets</a> of final results for all riders in all races since 1903. A few different fields than in the tidy tuesday winners set.</p>
<p>Now this is a ton of data to work with, and I won’t use it all. Figured I’d include the code to get it all in case you get inspired to grab it and take a look.</p>
<p>Ok…that’s it for cleaning &amp; prepping…charts and tables in <a href="https://www.gregdubrow.io/tidy-tuesday-apr-07-2020-LeTour-stage2/">Stage 2</a>.</p>
<p><em>This post was last updated on 2023-05-19</em></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://www.quarto.org">Built with Quarto</a>
  </li>  
</ul>
    </div>   
      <div class="nav-footer-center"><div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../../license.html">License</a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>